<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="img/hive-logo.ico" type="image/x-icon" />
    <title>Hive</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/site.css">
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous">
    </script>
    <script src="js/site.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <style>
        .canvasjs-chart-tooltip {
            pointer-events: auto !important;
        }
    </style>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</head>

<body>
    <div class="background text-center">
        <div class="container-fluid header">
            <div class="row">
                <div class="offset-1 col-5 title">
                    <span id="brand">
                        Hive
                        <img id="logo" alt="Image" src="img/hive-logo-main.png">
                    </span>
                </div>
                <div class="offset-2 col-4 search">
                    <div class="row">
                        <div class="col-sm-9 question">
                            <input type="text" class="form-control" placeholder="Enter a topic here..." id="question" value="" maxlength="100" />
                        </div>
                        <div class="col-sm-3">
                            <button type="submit" class="btn btn-outline-warning" onclick="askWatson()">Search</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid background">
            <div class="row content">
                <div class="col-8 display">
                    <div id="chartContainer" style="display:none">

                    </div>
                    <img id="placeholder" src="img/flying_bee.gif">
                </div>
                <div class="col-4 left-nav">
                    <div class="col-12 trending">
                        <h2>Trending</h2>
                        <div id="trending">
                            <div class="row up hasData" onclick="askBob('Trump')">
                                <div class="col-9 text-left">
                                    <h4>Trump .05</h4>
                                </div>
                                <div class="col-3 text-left"></div>
                            </div>
                            <hr>
                            <div class="row flat hasData" onclick="askBob('Bernie')">
                                <div class="col-9 text-left">
                                    <h4>Bernie .00</h4>
                                </div>
                                <div class="col-3 text-left"></div>
                            </div>
                            <hr>
                            <div class="row down noData">
                                <div class="col-9 text-left">
                                    <h4>Coronavirus .15</h4>
                                </div>
                                <div class="col-3 text-left"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid footer">
            <b>HIVE</b>
        </div>
    </div>
</body>

<script>
    var chartData = "";

    function titleCase(str) {
        var splitStr = str.toLowerCase().split(' ');
        for (var i = 0; i < splitStr.length; i++) {
            // You do not need to check if i is larger than splitStr length, as your for does that for you
            // Assign it back to the array
            splitStr[i] = splitStr[i].charAt(0).toUpperCase() + splitStr[i].substring(1);
        }
        // Directly return the joined string
        return splitStr.join(' ');
    }

    function getTrending() {
        var query = "/trending";
        $.get(query, function (err, req, resp) {
            if (req == "success") {
                var trending = resp.responseJSON.results;
                var trendingHasData = false;
                var defaultTopic = "";
                var html = "";
                for (var topic in trending) {
                    var currTopic = trending[topic];
                    var title = currTopic.query_string;
                    var change = currTopic.change;
                    if(change == 0) {
                        change = 0.00;
                    }
                    for (var i = 0; i < currTopic.results.length; i++) {
                        currTopic.results[i].x = new Date(currTopic.results[i].year, currTopic.results[i].month -
                            1, currTopic.results[i].day);
                        // console.log(results[i].x);
                    }
                    html += '<hr><div class="row ';

                    if (change > 0) {
                        html += 'up';
                    } else if (change < 0) {
                        html += 'down';
                    } else {
                        html += 'flat';
                    }

                    if (currTopic.results.length > 1) {
                        html += ' hasData " onclick="askBob(\'' + title + '\')';
                        if (!trendingHasData) {
                            trendingHasData = true;
                            defaultTopic = title;
                            bob.push(currTopic);
                        }
                    } else {
                        html += ' noData';
                    }
                    html += '">';

                    html += '<div class="col-9 text-left">'
                    html += '<h4>' + titleCase(title) + ' ' + currTopic.change + '</h4>'
                    html += '</div><div class="col-3 text-left"></div></div>'
                }
                $(html).appendTo("#trending");


                if (trendingHasData) {
                    askBob(defaultTopic);
                }

            } else {
                html = "No data found";
                $("#trending").html(html);
            }
        });
    }

    getTrending();

    function askWatson() {
        document.getElementById("chartContainer").style.display = "none"
        document.getElementById("placeholder").style.display = ""
        var question = $("#question").val();
        question = question.toLowerCase();

        var base = '/search/';
        var query = base.concat(question);

        chart.options.title.text = "Sentiment for " + question

        // HTTP GET request to Flask server
        $.get(query, function (err, req, resp) {
            if (req == "success") {
                console.log('I AM HERE')
                results = resp.responseJSON.results;

                for (var i = 0; i < results.length; i++) {
                    results[i].x = new Date(results[i].year, results[i].month - 1, results[i].day);
                    // console.log(results[i].x);

                }
                console.log(results)
                chart.options.data[0].dataPoints = results
                $('#chartContainer').css({
                    'border': 'solid black 5px'
                });
                document.getElementById("chartContainer").style.display = ""
                document.getElementById("placeholder").style.display = "none"
                chart.render();

            } else {
                chart.options.data[0].dataPoints = bob["default"];
                chart.options.data[0].dataPoints = results
                $('#chartContainer').css({
                    'border': 'solid black 5px'
                });
                document.getElementById("chartContainer").style.display = ""
                document.getElementById("placeholder").style.display = "none"
                chart.render();
            }
        });
    }

    function askBob(topic) {
        document.getElementById("chartContainer").style.display = "none"
        document.getElementById("placeholder").style.display = ""
        $("#chartContainer").empty();
        var chart = createChart();
        chart.options.title.text = "Sentiment for " + topic

        console.log(topic);
        chart.options.data[0].dataPoints = bob[topic];
        $('#chartContainer').css({
            'border': 'solid black 5px'
        });
        document.getElementById("chartContainer").style.display = ""
        document.getElementById("placeholder").style.display = "none"
        chart.render();
    }


    function createChart(chartData) {
        var chart = new CanvasJS.Chart("chartContainer", {
            animationEnabled: true,
            title: {
                text: "Sentiment Graph"
            },
            axisY: {
                maximum: 1,
                minimum: -1,
                title: "Sentiment"
            },
            axisX: {
                title: "Time",
                valueFormatString: "MMM DD",
                interval: 1
            },
            data: [{
                type: "line",
                toolTipContent: "<a href = {url}> {title}</a><hr/>Sentiment: {y}",

                // dataPoints: bob[question] || bob["default"]
            }]
        });
        return chart;
    }
    // console.log(results);

    var bob = {
        "default": [{
                "x": new Date(2012, 00, 1),
                "title": "Family of Four Found Dead in Disney Community, Suspect in Custody",
                "url": "https://en.wikinews.org/wiki/Family_of_Four_Found_Dead_in_Disney_Community,_Suspect_in_Custody",
                "y": -0.8
            },
            {
                "x": new Date(2012, 01, 1),
                "title": "Senator Ted Cruz proposes amendment to U.S. Constitution setting Congressional term limits",
                "url": "https://en.wikinews.org/wiki/Senator_Ted_Cruz_proposes_amendment_to_U.S._Constitution_setting_Congressional_term_limits",
                "y": 0.6
            },
            {
                "x": new Date(2012, 02, 1),
                "title": "State-run bus crashes in Cuba en route to Havana, killing seven",
                "url": "https://en.wikinews.org/wiki/State-run_bus_crashes_in_Cuba_en_route_to_Havana,_killing_seven",
                "y": -0.2
            },
            {
                "x": new Date(2012, 03, 1),
                "title": "NASA's TESS spacecraft reports its first exoplanet",
                "url": "https://en.wikinews.org/wiki/NASA%27s_TESS_spacecraft_reports_its_first_exoplanet",
                "y": 0.2
            },
            {
                "x": new Date(2012, 04, 1),
                "title": "Space Shuttle Discovery",
                "url": "https://en.wikinews.org/wiki/Category:Space_Shuttle_Discovery",
                "y": 0.6
            },
            {
                "x": new Date(2012, 05, 1),
                "title": "Slow-cooking dinosaur eggs may have contributed to extinction, say scientists",
                "url": "https://en.wikinews.org/wiki/Slow-cooking_dinosaur_eggs_may_have_contributed_to_extinction,_say_scientists",
                "y": 0.0
            },
            {
                "x": new Date(2012, 06, 1),
                "title": "Hurricane warning goes into effect in Bermuda as Gonzalo nears",
                "url": "https://en.wikinews.org/wiki/Hurricane_warning_goes_into_effect_in_Bermuda_as_Gonzalo_nears",
                "y": -0.9
            }
        ],
        "patriots": [{
                "x": new Date(2012, 00, 1),
                "title": "Family of Four Found Dead in Disney Community, Suspect in Custody",
                "url": "https://en.wikinews.org/wiki/Family_of_Four_Found_Dead_in_Disney_Community,_Suspect_in_Custody",
                "y": -0.6
            },
            {
                "x": new Date(2012, 01, 1),
                "title": "Senator Ted Cruz proposes amendment to U.S. Constitution setting Congressional term limits",
                "url": "https://en.wikinews.org/wiki/Senator_Ted_Cruz_proposes_amendment_to_U.S._Constitution_setting_Congressional_term_limits",
                "y": 0.2
            },
            {
                "x": new Date(2012, 02, 1),
                "title": "State-run bus crashes in Cuba en route to Havana, killing seven",
                "url": "https://en.wikinews.org/wiki/State-run_bus_crashes_in_Cuba_en_route_to_Havana,_killing_seven",
                "y": -0.8
            },
            {
                "x": new Date(2012, 03, 1),
                "title": "NASA's TESS spacecraft reports its first exoplanet",
                "url": "https://en.wikinews.org/wiki/NASA%27s_TESS_spacecraft_reports_its_first_exoplanet",
                "y": 0.8
            },
            {
                "x": new Date(2012, 04, 1),
                "title": "Space Shuttle Discovery",
                "url": "https://en.wikinews.org/wiki/Category:Space_Shuttle_Discovery",
                "y": 0.7
            },
            {
                "x": new Date(2012, 05, 1),
                "title": "Slow-cooking dinosaur eggs may have contributed to extinction, say scientists",
                "url": "https://en.wikinews.org/wiki/Slow-cooking_dinosaur_eggs_may_have_contributed_to_extinction,_say_scientists",
                "y": 0.1
            },
            {
                "x": new Date(2012, 06, 1),
                "title": "Hurricane warning goes into effect in Bermuda as Gonzalo nears",
                "url": "https://en.wikinews.org/wiki/Hurricane_warning_goes_into_effect_in_Bermuda_as_Gonzalo_nears",
                "y": -0.2
            }
        ],
        "Trump": [{
                "x": new Date(2012, 00, 1),
                "title": "fuck",
                "url": "https://en.wikinews.org/wiki/Family_of_Four_Found_Dead_in_Disney_Community,_Suspect_in_Custody",
                "y": -0.6
            },
            {
                "x": new Date(2012, 01, 1),
                "title": "Senator Ted Cruz proposes amendment to U.S. Constitution setting Congressional term limits",
                "url": "https://en.wikinews.org/wiki/Senator_Ted_Cruz_proposes_amendment_to_U.S._Constitution_setting_Congressional_term_limits",
                "y": 0.2
            },
            {
                "x": new Date(2012, 02, 1),
                "title": "State-run bus crashes in Cuba en route to Havana, killing seven",
                "url": "https://en.wikinews.org/wiki/State-run_bus_crashes_in_Cuba_en_route_to_Havana,_killing_seven",
                "y": -0.8
            },
            {
                "x": new Date(2012, 03, 1),
                "title": "NASA's TESS spacecraft reports its first exoplanet",
                "url": "https://en.wikinews.org/wiki/NASA%27s_TESS_spacecraft_reports_its_first_exoplanet",
                "y": 0.8
            },
            {
                "x": new Date(2012, 04, 1),
                "title": "Space Shuttle Discovery",
                "url": "https://en.wikinews.org/wiki/Category:Space_Shuttle_Discovery",
                "y": 0.7
            },
            {
                "x": new Date(2012, 05, 1),
                "title": "Slow-cooking dinosaur eggs may have contributed to extinction, say scientists",
                "url": "https://en.wikinews.org/wiki/Slow-cooking_dinosaur_eggs_may_have_contributed_to_extinction,_say_scientists",
                "y": 0.1
            },
            {
                "x": new Date(2012, 06, 1),
                "title": "Hurricane warning goes into effect in Bermuda as Gonzalo nears",
                "url": "https://en.wikinews.org/wiki/Hurricane_warning_goes_into_effect_in_Bermuda_as_Gonzalo_nears",
                "y": -0.2
            }
        ],
        "Bernie": [{
                "x": new Date(2012, 00, 1),
                "title": "yeet",
                "url": "https://en.wikinews.org/wiki/Family_of_Four_Found_Dead_in_Disney_Community,_Suspect_in_Custody",
                "y": -0.6
            },
            {
                "x": new Date(2012, 01, 1),
                "title": "Senator Ted Cruz proposes amendment to U.S. Constitution setting Congressional term limits",
                "url": "https://en.wikinews.org/wiki/Senator_Ted_Cruz_proposes_amendment_to_U.S._Constitution_setting_Congressional_term_limits",
                "y": 0.2
            },
            {
                "x": new Date(2012, 02, 1),
                "title": "State-run bus crashes in Cuba en route to Havana, killing seven",
                "url": "https://en.wikinews.org/wiki/State-run_bus_crashes_in_Cuba_en_route_to_Havana,_killing_seven",
                "y": -0.8
            },
            {
                "x": new Date(2012, 03, 1),
                "title": "NASA's TESS spacecraft reports its first exoplanet",
                "url": "https://en.wikinews.org/wiki/NASA%27s_TESS_spacecraft_reports_its_first_exoplanet",
                "y": 0.8
            },
            {
                "x": new Date(2012, 04, 1),
                "title": "Space Shuttle Discovery",
                "url": "https://en.wikinews.org/wiki/Category:Space_Shuttle_Discovery",
                "y": 0.7
            },
            {
                "x": new Date(2012, 05, 1),
                "title": "Slow-cooking dinosaur eggs may have contributed to extinction, say scientists",
                "url": "https://en.wikinews.org/wiki/Slow-cooking_dinosaur_eggs_may_have_contributed_to_extinction,_say_scientists",
                "y": 0.1
            },
            {
                "x": new Date(2012, 06, 1),
                "title": "Hurricane warning goes into effect in Bermuda as Gonzalo nears",
                "url": "https://en.wikinews.org/wiki/Hurricane_warning_goes_into_effect_in_Bermuda_as_Gonzalo_nears",
                "y": -0.2
            }
        ],
        "manchester united": [0, 5, 25, 3, 16, 27, 0],
        "google": [30, 40, 32, 20, 25, 10, 15]
    }
</script>

</html>